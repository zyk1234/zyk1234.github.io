<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">






  <link rel="canonical" href="http://yoursite.com/page/5/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hexo</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Startseite</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archiv</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/mongodb部分/9python交互/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/mongodb部分/9python交互/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-08-09 17:42:41" itemprop="dateModified" datetime="2018-08-09T17:42:41+08:00">2018-08-09</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="与python交互"><a href="#与python交互" class="headerlink" title="与python交互"></a>与python交互</h1><ul>
<li>引入模块pymongo<pre><code>from pymongo import *
</code></pre></li>
<li>主要提供如下对象用于进行交互<ul>
<li>MongoClient对象：用于与MongoDB服务器建立连接</li>
<li>DataBase对象：对应着MongoDB中的数据库</li>
<li>Collection对象：对应着MongoDB中的集合</li>
<li>Cursor对象：查询方法find()返回的对象，用于进行多行数据的遍历<h2 id="MongoClient对象"><a href="#MongoClient对象" class="headerlink" title="MongoClient对象"></a>MongoClient对象</h2></li>
</ul>
</li>
</ul>
<ul>
<li>使用init方法创建连接对象<pre><code>client=MongoClient(&apos;主机ip&apos;,端口)
</code></pre><h2 id="Database对象"><a href="#Database对象" class="headerlink" title="Database对象"></a>Database对象</h2></li>
</ul>
<ul>
<li>通过client对象获取获得数据库对象<pre><code>db=client.数据库名称
</code></pre><h2 id="Collection对象"><a href="#Collection对象" class="headerlink" title="Collection对象"></a>Collection对象</h2></li>
</ul>
<ul>
<li>通过db对象获取集合对象<pre><code>col=db.集合名称
</code></pre><h2 id="主要方法如下"><a href="#主要方法如下" class="headerlink" title="主要方法如下"></a>主要方法如下</h2></li>
<li>insert_one：加入一条文档对象</li>
<li>insert_many：加入多条文档对象</li>
<li>find_one：查找一条文档对象</li>
<li>find：查找多条文档对象</li>
<li>update_one：更新一条文档对象</li>
<li>update_many：更新多条文档对象</li>
<li>delete_one：删除一条文档对象</li>
<li>delete_many：删除多条文档对象<h2 id="Cursor对象"><a href="#Cursor对象" class="headerlink" title="Cursor对象"></a>Cursor对象</h2></li>
<li>当调用集合对象的find()方法时，会返回Cursor对象</li>
<li>结合for…in…遍历cursor对象</li>
</ul>
<h1 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h1><ul>
<li>方法insert_one接收一个字典作为参数，表示插入一条文档</li>
<li>方法insert_many接收一个列表作为参数，列表中的元素为字典，表示插入多条文档</li>
<li><p>创建mongodb_insert.py文件，代码如下</p>
<pre><code>#coding=utf-8
from pymongo import *

if __name__==&apos;__main__&apos;:
    try:
        #创建连接对象
        client=MongoClient(host=&apos;localhost&apos;,port=27017)
        #获得数据库，此处使用python数据库
        db=client.python
        #向集合stu中插入一条文档
        db.stu.insert_one({&apos;name&apos;:&apos;abc&apos;,&apos;gender&apos;:True})
        #如果插入成功则提示ok
        print &apos;ok&apos;
    except Exception as e:
        print e
</code></pre></li>
</ul>
<h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><ul>
<li>方法find_one()返回满足条件的文档集中第一条数据，类型为字典</li>
<li>方法find()返回满足条件的所有文档，类型为Cursor对象，可以使用for…in遍历，每项为字典对象</li>
<li><p>创建mongodb_find.py文件，代码如下</p>
<pre><code>#coding=utf-8
from pymongo import *

if __name__==&apos;__main__&apos;:
    try:
        #创建连接对象
        client=MongoClient(host=&apos;localhost&apos;,port=27017)
        #获得数据库，此处使用python数据库
        db=client.python
        #查询一条文档
        #result=db.stu.find_one()
        #print result

        #查询多条文档
        result=db.stu.find({&apos;hometown&apos;:&apos;大理&apos;})
        for item in result:
            print &apos;%s--%s&apos;%(item[&apos;name&apos;],item[&apos;hometown&apos;])
    except Exception, e:
        print e
</code></pre></li>
</ul>
<h1 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h1><ul>
<li>方法update_one()修改满足条件的文档集中的第一条文档</li>
<li>方法update_many()修改满足条件的文档集中的所有文档</li>
<li>注意：使用$set操作符修改特定属性的值，否则会修改整个文档</li>
<li><p>创建mongodb_update.py文件，代码如下</p>
<pre><code>#coding=utf-8
from pymongo import *

if __name__==&apos;__main__&apos;:
    try:
        #创建连接对象
        client=MongoClient(host=&apos;localhost&apos;,port=27017)
        #获得数据库，此处使用python数据库
        db=client.python
        #更新满足条件的第一条文档
        #db.stu.update_one({&apos;gender&apos;:False},{&apos;$set&apos;:{&apos;name&apos;:&apos;hehe&apos;}})

        #更新满足条件的所有文档
        db.stu.update_many({&apos;gender&apos;:True},{&apos;$set&apos;:{&apos;name&apos;:&apos;haha&apos;}})
        print &apos;ok&apos;
    except Exception as e:
        print e
</code></pre></li>
</ul>
<h1 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h1><ul>
<li>方法delete_one()删除满足条件的文档集中第一条文档</li>
<li>方法delete_many()删除满足条件的所有文档</li>
<li><p>创建mongodb_delete.py文件，代码如下</p>
<pre><code>#coding=utf-8
from pymongo import *

if __name__==&apos;__main__&apos;:
    try:
        #创建连接对象
        client=MongoClient(host=&apos;localhost&apos;,port=27017)
        #获得数据库，此处使用python数据库
        db=client.python
        #删除满足条件的第一条文档
        #db.stu.delete_one({&apos;gender&apos;:False})

        #删除满足条件的所有文档
        db.stu.delete_many({&apos;gender&apos;:True})
        print &apos;ok&apos;
    except Exception as e:
        print e
</code></pre></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/mongodb部分/8备份恢复/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/mongodb部分/8备份恢复/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-08-09 17:25:24" itemprop="dateModified" datetime="2018-08-09T17:25:24+08:00">2018-08-09</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><ul>
<li>语法<pre><code>mongodump -h dbhost -d dbname -o dbdirectory
</code></pre></li>
<li>-h：服务器地址，也可以指定端口号</li>
<li>-d：需要备份的数据库名称</li>
<li>-o：备份的数据存放位置，此目录中存放着备份出来的数据</li>
</ul>
<ul>
<li>例1<pre><code>sudo mkdir test1bak
sudo mongodump -h 192.168.50.128:27017 -d test1 -o ~/Desktop/test1bak
</code></pre><h1 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h1></li>
</ul>
<ul>
<li>语法<pre><code>mongorestore -h dbhost -d dbname --dir dbdirectory
</code></pre>-h：服务器地址<br>-d：需要恢复的数据库实例<br>–dir：备份数据所在位置</li>
</ul>
<ul>
<li>例2<pre><code>mongorestore -h 192.168.196.128:27017 -d test2 --dir ~/Desktop/test1bak/test1
</code></pre></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/mongodb部分/7索引/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/mongodb部分/7索引/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-08-09 17:23:06" itemprop="dateModified" datetime="2018-08-09T17:23:06+08:00">2018-08-09</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><ul>
<li>在mysql中已经学习了索引，并知道索引对于查询速度的提升</li>
<li>mongodb也支持索引，以提升查询速度<h2 id="步骤一：创建大量数据"><a href="#步骤一：创建大量数据" class="headerlink" title="步骤一：创建大量数据"></a>步骤一：创建大量数据</h2></li>
<li>在命令行中执行如下代码，向集合中插入10万条文档</li>
<li>注意：不要在图形界面中执行，因为软件原因无法插入10万条数据就会中断执行<pre><code>for(i=0;i&lt;100000;i++){
    db.t1.insert({name:&apos;test&apos;+i,age:i})
}
</code></pre><h2 id="步骤二：数据查找性能分析"><a href="#步骤二：数据查找性能分析" class="headerlink" title="步骤二：数据查找性能分析"></a>步骤二：数据查找性能分析</h2></li>
</ul>
<ul>
<li>查找姓名为’test10000’的文档<pre><code>db.t1.find({name:&apos;test10000&apos;})
</code></pre></li>
</ul>
<ul>
<li>使用explain()命令进行查询性能分析<pre><code>db.t1.find({name:&apos;test10000&apos;}).explain(&apos;executionStats&apos;)
</code></pre></li>
</ul>
<ul>
<li>其中的executionStats下的executionTimeMillis表示整体查询时间，单位是毫秒</li>
</ul>
<h2 id="步骤三：建立索引"><a href="#步骤三：建立索引" class="headerlink" title="步骤三：建立索引"></a>步骤三：建立索引</h2><ul>
<li>创建索引</li>
<li>1表示升序，-1表示降序<pre><code>db.集合.ensureIndex({属性:1})
如
db.t1.ensureIndex({name:1})
</code></pre><h2 id="步骤四：对索引属性查询"><a href="#步骤四：对索引属性查询" class="headerlink" title="步骤四：对索引属性查询"></a>步骤四：对索引属性查询</h2></li>
</ul>
<ul>
<li>执行上面的同样的查询，并进行查询性能分析<pre><code>db.t1.find({name:&apos;test10000&apos;}).explain(&apos;executionStats&apos;)
</code></pre></li>
</ul>
<h2 id="索引的命令"><a href="#索引的命令" class="headerlink" title="索引的命令"></a>索引的命令</h2><ul>
<li>建立唯一索引，实现唯一约束的功能<pre><code>db.t1.ensureIndex({&quot;name&quot;:1},{&quot;unique&quot;:true})
</code></pre></li>
</ul>
<ul>
<li>联合索引，对多个属性建立一个索引，按照find()出现的顺序<pre><code>db.t1.ensureIndex({name:1,age:1})
</code></pre></li>
</ul>
<ul>
<li>查看文档所有索引<pre><code>db.t1.getIndexes()
</code></pre></li>
</ul>
<ul>
<li>删除索引<pre><code>db.t1.dropIndex(&apos;索引名称&apos;)
</code></pre></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/mongodb部分/6聚合/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/mongodb部分/6聚合/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-08-20 22:52:23" itemprop="dateModified" datetime="2018-08-20T22:52:23+08:00">2018-08-20</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="聚合-aggregate"><a href="#聚合-aggregate" class="headerlink" title="聚合 aggregate"></a>聚合 aggregate</h1><p><a href="http://www.runoob.com/mongodb/mongodb-aggregate.html" target="_blank" rel="noopener">http://www.runoob.com/mongodb/mongodb-aggregate.html</a></p>
<ul>
<li>聚合(aggregate)主要用于计算数据，类似sql中的sum()、avg()</li>
<li><p>语法</p>
<pre><code>db.集合名称.aggregate({管道:{表达式}})
</code></pre></li>
<li><p>常用管道</p>
<ul>
<li>$group：将集合中的文档分组，可用于统计结果</li>
<li>$match：过滤数据，只输出符合条件的文档</li>
<li>$project：修改输入文档的结构，如重命名、增加、删除字段、创建计算结果</li>
<li>$sort：将输入文档排序后输出</li>
<li>$limit：限制聚合管道返回的文档数</li>
<li>$skip：跳过指定数量的文档，并返回余下的文档</li>
<li>$unwind：将数组类型的字段进行拆分</li>
</ul>
</li>
</ul>
<h2 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h2><ul>
<li>处理输入文档并输出</li>
<li>语法<pre><code>表达式:&apos;$列名&apos;
</code></pre></li>
<li>常用表达式<ul>
<li>$sum：计算总和，$sum:1 表示以一倍计数</li>
<li>$avg：计算平均值</li>
<li>$min：获取最小值</li>
<li>$max：获取最大值</li>
<li>$push：在结果文档中插入值到一个数组中</li>
<li>$first：根据资源文档的排序获取第一个文档数据</li>
<li>$last：根据资源文档的排序获取最后一个文档数据</li>
</ul>
</li>
</ul>
<h1 id="group"><a href="#group" class="headerlink" title="$group"></a>$group</h1><ul>
<li>将集合中的文档分组，可用于统计结果</li>
<li>_id表示分组的依据，使用某个字段的格式为’$字段’</li>
<li>例1：统计男生、女生的总人数<pre><code>db.stu.aggregate(
    {$group:
        {
            _id:&apos;$gender&apos;,
            counter:{$sum:1}
        }
    }
)
</code></pre><h2 id="Group-by-null"><a href="#Group-by-null" class="headerlink" title="Group by null"></a>Group by null</h2></li>
<li>将集合中所有文档分为一组</li>
<li>例2：求学生总人数、平均年龄<pre><code>db.stu.aggregate(
    {$group:
        {
            _id:null,
            counter:{$sum:1},
            avgAge:{$avg:&apos;$age&apos;}
        }
    }
)
</code></pre><h2 id="透视数据"><a href="#透视数据" class="headerlink" title="透视数据"></a>透视数据</h2></li>
</ul>
<ul>
<li>例3：统计学生性别及学生姓名<pre><code>db.stu.aggregate(
    {$group:
        {
            _id:&apos;$gender&apos;,
            name:{$push:&apos;$name&apos;}
        }
    }
)
</code></pre></li>
</ul>
<ul>
<li>使用$$ROOT可以将文档内容加入到结果集的数组中，代码如下<pre><code>db.stu.aggregate(
    {$group:
        {
            _id:&apos;$gender&apos;,
            name:{$push:&apos;$$ROOT&apos;}
        }
    }
)
</code></pre></li>
</ul>
<h1 id="match"><a href="#match" class="headerlink" title="$match"></a>$match</h1><ul>
<li>用于过滤数据，只输出符合条件的文档</li>
<li>使用MongoDB的标准查询操作</li>
<li>例1：查询年龄大于20的学生<pre><code>db.stu.aggregate(
    {$match:{age:{$gt:20}}}
)
</code></pre></li>
</ul>
<ul>
<li>例2：查询年龄大于20的男生、女生人数<pre><code>db.stu.aggregate(
    {$match:{age:{$gt:20}}},
    {$group:{_id:&apos;$gender&apos;,counter:{$sum:1}}}
)
</code></pre></li>
</ul>
<h1 id="project"><a href="#project" class="headerlink" title="$project"></a>$project</h1><ul>
<li>修改输入文档的结构，如重命名、增加、删除字段、创建计算结果</li>
<li>例1：查询学生的姓名、年龄<pre><code>db.stu.aggregate(
    {$project:{_id:0,name:1,age:1}}
)
</code></pre></li>
</ul>
<ul>
<li>例2：查询男生、女生人数，输出人数<pre><code>db.stu.aggregate(
    {$group:{_id:&apos;$gender&apos;,counter:{$sum:1}}},
    {$project:{_id:0,counter:1}}
)
</code></pre></li>
</ul>
<h1 id="sort"><a href="#sort" class="headerlink" title="$sort"></a>$sort</h1><ul>
<li>将输入文档排序后输出</li>
<li>例1：查询学生信息，按年龄升序<pre><code>b.stu.aggregate({$sort:{age:1}})
</code></pre></li>
</ul>
<ul>
<li>例2：查询男生、女生人数，按人数降序<pre><code>db.stu.aggregate(
    {$group:{_id:&apos;$gender&apos;,counter:{$sum:1}}},
    {$sort:{counter:-1}}
)
</code></pre></li>
</ul>
<h1 id="limit"><a href="#limit" class="headerlink" title="$limit"></a>$limit</h1><ul>
<li>限制聚合管道返回的文档数</li>
<li>例1：查询2条学生信息<pre><code>db.stu.aggregate({$limit:2})
</code></pre></li>
</ul>
<h1 id="skip"><a href="#skip" class="headerlink" title="$skip"></a>$skip</h1><ul>
<li>跳过指定数量的文档，并返回余下的文档</li>
<li>例2：查询从第3条开始的学生信息<pre><code>db.stu.aggregate({$skip:2})
</code></pre></li>
</ul>
<ul>
<li>例3：统计男生、女生人数，按人数升序，取第二条数据<pre><code>db.stu.aggregate(
    {$group:{_id:&apos;$gender&apos;,counter:{$sum:1}}},
    {$sort:{counter:1}},
    {$skip:1},
    {$limit:1}
)
</code></pre></li>
</ul>
<ul>
<li><strong> 注意顺序：先写skip，再写limit</strong></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/mongodb部分/5查询2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/mongodb部分/5查询2/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-08-08 17:50:08" itemprop="dateModified" datetime="2018-08-08T17:50:08+08:00">2018-08-08</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Limit"><a href="#Limit" class="headerlink" title="Limit"></a>Limit</h1><ul>
<li>方法limit()：用于读取指定数量的文档</li>
<li>语法：<pre><code>db.集合名称.find().limit(NUMBER)
</code></pre></li>
<li>参数NUMBER表示要获取文档的条数</li>
<li>如果没有指定参数则显示集合中的所有文档<br>例1：查询2条学生信息<pre><code>db.stu.find().limit(2)
</code></pre></li>
</ul>
<h1 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h1><ul>
<li>方法skip()：用于跳过指定数量的文档</li>
<li>语法：<pre><code>db.集合名称.find().skip(NUMBER)
</code></pre></li>
</ul>
<ul>
<li>参数NUMBER表示跳过的记录条数，默认值为0</li>
</ul>
<ul>
<li>例2：查询从第3条开始的学生信息<pre><code>db.stu.find().skip(2)
</code></pre></li>
</ul>
<ul>
<li>一起使用</li>
</ul>
<ul>
<li>方法limit()和skip()可以一起使用，不分先后顺序</li>
</ul>
<ul>
<li><p>创建数据集</p>
<pre><code>for(i=0;i&lt;15;i++){
    db.t1.insert({_id:i})
}
</code></pre></li>
</ul>
<ul>
<li>查询第5至8条数据<pre><code>db.stu.find().limit(4).skip(5)
或
db.stu.find().skip(5).limit(4)
</code></pre></li>
</ul>
<h1 id="投影"><a href="#投影" class="headerlink" title="投影"></a>投影</h1><ul>
<li>在查询到的返回结果中，只选择必要的字段，而不是选择一个文档的整个字段</li>
<li>如：一个文档有5个字段，需要显示只有3个，投影其中3个字段即可</li>
<li>语法：</li>
<li>参数为字段与值，值为1表示显示，值为0不显示<pre><code>db.集合名称.find({},{字段名称:1,...})
</code></pre></li>
<li>对于需要显示的字段，设置为1即可，不设置即为不显示</li>
<li>特殊：对于_id列默认是显示的，如果不显示需要明确设置为0<pre><code>例1
db.stu.find({},{name:1,gender:1})
例2
db.stu.find({},{_id:0,name:1,gender:1})
</code></pre></li>
</ul>
<h1 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h1><ul>
<li>方法sort()，用于对结果集进行排序</li>
<li>语法<pre><code>db.集合名称.find().sort({字段:1,...})
</code></pre></li>
<li>参数1为升序排列</li>
<li>参数-1为降序排列</li>
<li>例1：根据性别降序，再根据年龄升序<pre><code>db.stu.find().sort({gender:-1,age:1})
</code></pre></li>
</ul>
<h1 id="统计个数"><a href="#统计个数" class="headerlink" title="统计个数"></a>统计个数</h1><ul>
<li>方法count()用于统计结果集中文档条数</li>
<li>语法<pre><code>db.集合名称.find({条件}).count()
</code></pre></li>
<li>也可以与为<pre><code>db.集合名称.count({条件})
</code></pre></li>
<li>例1：统计男生人数<pre><code>db.stu.find({gender:true}).count()
</code></pre></li>
<li>例2：统计年龄大于20的男生人数<pre><code>db.stu.count({age:{$gt:20},gender:true})
</code></pre></li>
</ul>
<h1 id="消除重复"><a href="#消除重复" class="headerlink" title="消除重复"></a>消除重复</h1><ul>
<li>方法distinct()对数据进行去重</li>
<li>语法<pre><code>db.集合名称.distinct(&apos;去重字段&apos;,{条件})
</code></pre></li>
<li>例:查找年龄大于18的学生，来自哪些省份<pre><code>db.stu.distinct(&apos;hometown&apos;,{age:{$gt:18}})
</code></pre></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/mongodb部分/4查询1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/mongodb部分/4查询1/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-08-08 17:45:18" itemprop="dateModified" datetime="2018-08-08T17:45:18+08:00">2018-08-08</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h1><h2 id="基本查询"><a href="#基本查询" class="headerlink" title="基本查询"></a>基本查询</h2><ul>
<li>方法find()：查询<pre><code>db.集合名称.find({条件文档})
</code></pre></li>
<li>方法findOne()：查询，只返回第一个<pre><code>db.集合名称.findOne({条件文档})
</code></pre></li>
<li>方法pretty()：将结果格式化<pre><code>db.集合名称.find({条件文档}).pretty()
</code></pre><h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2></li>
<li>等于，默认是等于判断，没有运算符</li>
<li>小于$lt</li>
<li>小于或等于$lte</li>
<li>大于$gt</li>
<li>大于或等于$gte</li>
<li>不等于$ne<pre><code>例1：查询名称等于&apos;郭靖&apos;的学生
db.stu.find({name:&apos;郭靖&apos;})
例2：查询年龄大于或等于18的学生
db.stu.find({age:{$gte:18}})
</code></pre></li>
</ul>
<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><ul>
<li>查询时可以有多个条件，多个条件之间需要通过逻辑运算符连接</li>
<li>逻辑与：默认是逻辑与的关系<pre><code>例3：查询年龄大于或等于18，并且性别为true的学生
db.stu.find({age:{$gte:18},gender:true})
逻辑或：使用$or，值为数组，数组中每个元素为json
例4：查询年龄大于18，或性别为false的学生
db.stu.find({$or:[{age:{$gt:18}},{gender:false}]})
and和or一起使用
例5：查询年龄大于18或姓名是郭靖，并且性别为男生
db.stu.find({$or:[{age:{$gte:18}},{gender:true}],name:&apos;gj&apos;})
</code></pre></li>
</ul>
<h2 id="范围运算符"><a href="#范围运算符" class="headerlink" title="范围运算符"></a>范围运算符</h2><ul>
<li>使用”$in”，”$nin” 判断是否在某个范围内<pre><code>例6：查询年龄为18、28的学生
db.stu.find({age:{$in:[18,28]}})
</code></pre></li>
</ul>
<h2 id="支持正则表达式"><a href="#支持正则表达式" class="headerlink" title="支持正则表达式"></a>支持正则表达式</h2><ul>
<li>mongodb提供的终端shell，同时也是一个js的执行器，可以编写js的代码和函数</li>
<li>使用//或$regex编写正则表达式<pre><code>例7：查询姓黄的学生
db.stu.find({name:/^黄/})
db.stu.find({name:{$regex:&apos;^黄&apos;}})
</code></pre></li>
</ul>
<h2 id="自定义查询"><a href="#自定义查询" class="headerlink" title="自定义查询"></a>自定义查询</h2><ul>
<li>使用$where后面写一个函数，返回满足条件的数据</li>
</ul>
<ul>
<li>例7：查询年龄大于30的学生<pre><code>db.stu.find({
    $where:function() {
        return this.age&gt;30;
    }
})
</code></pre></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/mongodb部分/3操作/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/mongodb部分/3操作/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-08-21 19:14:47" itemprop="dateModified" datetime="2018-08-21T19:14:47+08:00">2018-08-21</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据库命令"><a href="#数据库命令" class="headerlink" title="数据库命令"></a>数据库命令</h1><ul>
<li>连接成功后，默认使用test数据库</li>
<li>查看当前数据库名称<pre><code>db
</code></pre></li>
<li>查看所有数据库名称，列出所有在物理上存在的数据库<pre><code>show dbs
</code></pre></li>
<li>切换数据库，如果数据库不存在也并不创建，直到插入数据或创建集合时数据库才被创建<pre><code>use 数据库名称
</code></pre></li>
<li>删除当前指向的数据库，如果数据库不存在，则什么也不做<pre><code>db.dropDatabase()
</code></pre></li>
</ul>
<h1 id="集合命令"><a href="#集合命令" class="headerlink" title="集合命令"></a>集合命令</h1><ul>
<li>创建语法如下</li>
<li>name是要创建的集合的名称</li>
<li>options是一个文档，用于指定集合的配置，选项​​参数是可选的，所以只需要到指定的集合名称</li>
<li>可以不手动创建集合，向不存在的集合中第一次加入数据时，集合会被创建出来<pre><code>db.createCollection(name, options)
例1：不限制集合大小
db.createCollection(&quot;stu&quot;)
</code></pre></li>
<li>例2：限制集合大小，后面学会插入语句后可以查看效果</li>
<li>参数capped：默认值为false表示不设置上限，值为true表示设置上限</li>
<li>参数size：当capped值为true时，需要指定此参数，表示上限大小，当文档达到上限时，会将之前的数据覆盖，单位为KB<pre><code>db.createCollection(&quot;sub&quot;, { capped : true, size : 10 } )
</code></pre></li>
<li>查看当前数据库的集合<pre><code>show collections
</code></pre></li>
<li>删除命令<pre><code>db.集合名称.drop()
</code></pre></li>
</ul>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><ul>
<li>Object ID：文档ID</li>
<li>String：字符串，最常用，必须是有效的UTF-8</li>
<li>Boolean：存储一个布尔值，true或false</li>
<li>Integer：整数可以是32位或64位，这取决于服务器</li>
<li>Double：存储浮点值</li>
<li>Arrays：数组或列表，多个值存储到一个键</li>
<li>Object：用于嵌入式的文档，即一个值为一个文档</li>
<li>Null：存储Null值</li>
<li>Timestamp：时间戳，表示从1970-1-1到现在的总秒数</li>
<li><p>Date：存储当前日期或时间的UNIX时间格式</p>
</li>
<li><p>创建日期语句如下</p>
</li>
<li><p>注意：参数的格式为YYYY-MM-DD</p>
<pre><code>new Date(&apos;2017-12-20&apos;)
</code></pre><h2 id="object-id"><a href="#object-id" class="headerlink" title="object id"></a>object id</h2></li>
<li>每个文档都有一个属性，为_id，保证每个文档的唯一性</li>
<li>可以自己去设置_id插入文档</li>
<li>如果没有提供，那么MongoDB为每个文档提供了一个独特的_id，类型为objectID</li>
<li>objectID是一个12字节的十六进制数<ul>
<li>前4个字节为当前时间戳</li>
<li>接下来3个字节的机器ID</li>
<li>接下来的2个字节中MongoDB的服务进程id</li>
<li>最后3个字节是简单的增量值</li>
</ul>
</li>
</ul>
<h1 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h1><ul>
<li>语法<pre><code>db.集合名称.insert(document)
</code></pre></li>
<li>插入文档时，如果不指定_id参数，MongoDB会为文档分配一个唯一的ObjectId<pre><code>例1
db.stu.insert({name:&apos;gj&apos;,gender:1})
例2
s1={_id:&apos;20160101&apos;,name:&apos;hr&apos;}
s1.gender=0
db.stu.insert(s1)
</code></pre><h1 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h1></li>
<li>语法<pre><code>db.集合名称.find()
</code></pre><h1 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h1></li>
<li>语法<pre><code>db.集合名称.update(
    &lt;query&gt; ,&lt;update&gt;,{multi: &lt;boolean&gt;}
)
</code></pre></li>
<li>参数query:查询条件，类似sql语句update中where部分</li>
<li>参数update:更新操作符，类似sql语句update中set部分</li>
<li><p>参数multi:可选，默认是false，表示只更新找到的第一条记录，值为true表示把满足条件的文档全部更新</p>
<pre><code>例4：指定属性更新，通过操作符$set
db.stu.insert({name:&apos;hr&apos;,gender:0})
db.stu.update({name:&apos;hr&apos;},{$set:{name:&apos;hys&apos;}})
例5：修改多条匹配到的数据
db.stu.update({},{$set:{gender:0}},{multi:true})
</code></pre><h1 id="保存"><a href="#保存" class="headerlink" title="保存"></a>保存</h1></li>
<li>语法<pre><code>db.集合名称.save(document)
</code></pre></li>
<li><p>如果文档的_id已经存在则修改，如果文档的_id不存在则添加</p>
<pre><code>例6 
db.stu.save({_id:&apos;20160102&apos;,&apos;name&apos;:&apos;yk&apos;,gender:1})
例7
db.stu.save({_id:&apos;20160102&apos;,&apos;name&apos;:&apos;wyk&apos;})
</code></pre><h1 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h1></li>
<li>语法<pre><code>db.集合名称.remove(
    &lt;query&gt;,{justOne: &lt;boolean&gt;}
)
</code></pre></li>
<li>参数query:可选，删除的文档的条件</li>
<li>参数justOne:可选，如果设为true或1，则只删除一条，默认false，表示删除多条<pre><code>例8：只删除匹配到的第一条
db.stu.remove({gender:0},{justOne:true})
例9：全部删除
db.stu.remove({})
</code></pre></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/mongodb部分/2安装/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/mongodb部分/2安装/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-12-10 14:10:54" itemprop="dateModified" datetime="2018-12-10T14:10:54+08:00">2018-12-10</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="mongodb安装"><a href="#mongodb安装" class="headerlink" title="mongodb安装"></a>mongodb安装</h1><h2 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h2><ol>
<li>解压缩</li>
<li>配置环境变量</li>
<li>创建数据目录</li>
<li>安装服务:管理员方式  运行cmd</li>
</ol>
<pre><code>mongod --dbpath D:\mongodb\mongodb\data --logpath=D:\mongodb\mongodb\log\mongodb.log --port 27017 --bind_ip 0.0.0.0  --install --serviceName &quot;MongoDB&quot;
</code></pre><h2 id="linux下的安装"><a href="#linux下的安装" class="headerlink" title="linux下的安装"></a>linux下的安装</h2><ol>
<li>解压缩tar包<pre><code>tar zvxf mongodb-linux-x86_64-4.0.1.tgz
</code></pre></li>
<li>将1步产生的文件夹放到/usr/local/mongodb下面<pre><code>mv mongodb-linux-x86_64-4.0.1 /usr/local/mongodb
</code></pre></li>
<li>创建mongodb的数据文件夹<pre><code>mkdir /usr/local/mongodb/db -p
</code></pre></li>
<li>在/usr/local/mongodb/目录下创建mongodb.conf配置文件<pre><code>vi mongodb.conf
#mongodb.conf
port=27017 #端口  
dbpath=/usr/local/mongodb/db #数据库存文件存放目录  
logpath=/usr/local/mongodb/mongodb.log #日志文件存放路径  
logappend=true #使用追加的方式写日志   
maxConns=100 #最大同时连接数   
journal=true #每次写入会记录一条操作日志（通过journal可以重新构造出写入的数据）。
bind_ip=0.0.0.0  #这样就可外部访问了，例如从win10中访问
fork=true
</code></pre></li>
<li><p>添加开机自己启动服务</p>
<p> -在/lib/systemd/system/目录下新建mongodb.service文件,内容如下:</p>
<pre><code>[Unit]

Description=mongodb 
After=network.target remote-fs.target nss-lookup.target

[Service]
Type=forking
ExecStart=/usr/local/mongodb/bin/mongod --config /usr/local/mongodb/mongodb.conf
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/usr/local/mongodb/bin/mongod --shutdown --config /usr/local/mongodb/mongodb.conf
PrivateTmp=true

[Install]
WantedBy=multi-user.target
</code></pre><p> -对上述访问设置权限</p>
<pre><code>chmod 754 mongodb.service
</code></pre></li>
<li><p>启动服务，并且设置开机自启动</p>
<pre><code>#启动服务
systemctl start mongodb.service  
#开机启动  
systemctl enable mongodb.service 
</code></pre></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/mongodb部分/1mongodb简介/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/mongodb部分/1mongodb简介/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-08-19 21:28:49" itemprop="dateModified" datetime="2018-08-19T21:28:49+08:00">2018-08-19</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="NoSQL简介"><a href="#NoSQL简介" class="headerlink" title="NoSQL简介"></a>NoSQL简介</h1><ul>
<li>“NoSQL”一词最早于1998年被用于一个轻量级的关系数据库的名字</li>
<li>随着web2.0的快速发展，NoSQL概念在2009年被提了出来，非关系型、分布式数据存储得到了快速的发展，它们不保证关系数据的ACID特性</li>
<li>NoSQL在2010年风生水起，现在国内外众多大小网站，如facebook、goole、淘宝、京东、百度等，都在使用nosql开发高性能的产品</li>
<li>对于一名程序员来讲，使用nosql已经成为一条必备技能</li>
<li>NoSQL最常见的解释是“non-relational”，“Not Only SQL”也被很多人接受，指的是非关系型的数据库<h2 id="传统关系数据库的瓶颈"><a href="#传统关系数据库的瓶颈" class="headerlink" title="传统关系数据库的瓶颈"></a>传统关系数据库的瓶颈</h2></li>
<li>在90年代，一个网站的访问量一般都不大，用单个数据库完全可以轻松应付。在那个时候，更多的都是静态网页，动态交互类型的网站不多。进入21世纪，随着基础网络设施的建设，互联网逐渐被大众接受并使用，网站开始快速发展。火爆的论坛、博客、sns、微博逐渐引领web领域的潮流。随着3G、4G移动互联技术的研发与推广，上网逐渐成为日常生活中的重要组成部分，这就是使网站的访问量巨大，对于数据库的请求也更频繁</li>
<li>在互联网领域，MySQL成为了绝对的王者，毫不夸张的说，MySQL为互联网的发展做出了卓越的贡献。大部分的MySQL都应该是IO密集型的，大数据量高并发环境下的MySQL应用开发越来越复杂，也越来越具有技术挑战性。分表分库的规则把握都是需要经验的。虽然有像淘宝这样技术实力强大的公司开发了透明的中间件层来屏蔽开发者的复杂性，但是避免不了整个架构的复杂性。分库分表的子库到一定阶段又面临扩展问题。还有就是需求的变更，可能又需要一种新的分库方式。MySQL数据库也经常存储一些大文本字段，导致数据库表非常的大，在做数据库恢复的时候就导致非常的慢，不容易快速恢复数据库。比如1000万4KB大小的文本就接近40GB的大小，如果能把这些数据从MySQL省去，MySQL将变得非常的小</li>
<li>关系数据库很强大，但是它并不能很好的应付所有的应用场景。MySQL的扩展性差，大数据下IO压力大，表结构更改困难</li>
</ul>
<h2 id="NOSQL的优势"><a href="#NOSQL的优势" class="headerlink" title="NOSQL的优势"></a>NOSQL的优势</h2><ul>
<li>易扩展：NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。数据之间无关系，这样就非常容易扩展</li>
<li>大数据量，高性能：NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。这得益于它的无关系性，数据库的结构简单</li>
<li>灵活的数据模型：NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系数据库里，增删字段是一件非常麻烦的事情。如果是非常大数据量的表，增加字段简直就是一个噩梦</li>
<li>高可用：NoSQL在不太影响性能的情况，就可以方便的实现高可用的架构<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2></li>
<li>NoSQL数据库的出现，弥补了关系数据（比如MySQL）在某些方面的不足，在某些方面能极大的节省开发成本和维护成本</li>
<li>MySQL和NoSQL都有各自的特点和使用的应用场景，两者的紧密结合将会给数据库发展带来新的思路。让关系数据库关注在关系上，NoSQL关注在存储上</li>
</ul>
<h1 id="MongoDB简介"><a href="#MongoDB简介" class="headerlink" title="MongoDB简介"></a>MongoDB简介</h1><ul>
<li>MongoDB 是一个基于分布式文件存储的NoSQL数据库</li>
<li>由C++语言编写，运行稳定，性能高</li>
<li>旨在为WEB应用提供可扩展的高性能数据存储解决方案</li>
</ul>
<h2 id="专有名词"><a href="#专有名词" class="headerlink" title="专有名词"></a>专有名词</h2><table>
<thead>
<tr>
<th>SQL术语/概念</th>
<th style="text-align:center">MongoDB术语/概念</th>
<th style="text-align:right">解释/说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>database</td>
<td style="text-align:center">database</td>
<td style="text-align:right">数据库</td>
</tr>
<tr>
<td>table</td>
<td style="text-align:center">collection</td>
<td style="text-align:right">数据库表/集合</td>
</tr>
<tr>
<td>row</td>
<td style="text-align:center">document</td>
<td style="text-align:right">数据记录行/文档</td>
</tr>
<tr>
<td>column</td>
<td style="text-align:center">field</td>
<td style="text-align:right">数据字段/域</td>
</tr>
<tr>
<td>index</td>
<td style="text-align:center">index</td>
<td style="text-align:right">索引</td>
</tr>
<tr>
<td>primary key</td>
<td style="text-align:center">primary key</td>
<td style="text-align:right">主键,MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody>
</table>
<h1 id="MongoDB特点"><a href="#MongoDB特点" class="headerlink" title="MongoDB特点"></a>MongoDB特点</h1><ul>
<li>模式自由 :可以把不同结构的文档存储在同一个数据库里</li>
<li>面向集合的存储：适合存储 JSON风格文件的形式</li>
<li>完整的索引支持：对任何属性可索引</li>
<li>复制和高可用性：支持服务器之间的数据复制，支持主-从模式及服务器之间的相互复制。复制的主要目的是提供冗余及自动故障转移</li>
<li>自动分片：支持云级别的伸缩性：自动分片功能支持水平的数据库集群，可动态添加额外的机器</li>
<li>丰富的查询：支持丰富的查询表达方式，查询指令使用JSON形式的标记，可轻易查询文档中的内嵌的对象及数组</li>
<li>快速就地更新：查询优化器会分析查询表达式，并生成一个高效的查询计划</li>
<li>高效的传统存储方式：支持二进制数据及大型对象（如照片或图片）</li>
</ul>
<h1 id="MongoDB-三元素"><a href="#MongoDB-三元素" class="headerlink" title="MongoDB 三元素"></a>MongoDB 三元素</h1><ul>
<li>三元素：数据库，集合，文档</li>
<li></li>
<li>集合就是关系数据库中的表</li>
<li></li>
<li>文档对应着关系数据库中的行</li>
<li></li>
<li><p>文档，就是一个对象，由键值对构成，是json的扩展Bson形式</p>
<pre><code>{&apos;name&apos;:&apos;guojing&apos;,&apos;gender&apos;:&apos;男&apos;}
</code></pre></li>
</ul>
<ul>
<li>集合：类似于关系数据库中的表，储存多个文档，结构不固定，如可以存储如下文档在一个集合中<pre><code>{&apos;name&apos;:&apos;guojing&apos;,&apos;gender&apos;:&apos;男&apos;}
{&apos;name&apos;:&apos;huangrong&apos;,&apos;age&apos;:18}
{&apos;book&apos;:&apos;shuihuzhuan&apos;,&apos;heros&apos;:&apos;108&apos;}
</code></pre></li>
<li>数据库：是一个集合的物理容器，一个数据库中可以包含多个文档</li>
<li>一个服务器通常有多个数据库<blockquote>
<p>推荐阅读<br>菜鸟教程-mongodb教程</p>
</blockquote>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/06/database/hbase部分/hbase完全分布式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/06/database/hbase部分/hbase完全分布式/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2019-01-06 15:45:57" itemprop="dateCreated datePublished" datetime="2019-01-06T15:45:57+08:00">2019-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-12-05 12:40:34" itemprop="dateModified" datetime="2018-12-05T12:40:34+08:00">2018-12-05</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="hbase完全分布式"><a href="#hbase完全分布式" class="headerlink" title="hbase完全分布式"></a>hbase完全分布式</h1><p>集群规划<br>3台机器</p>
<pre><code>172.168.20.206  master
172.168.20.207  slave1
172.168.20.208  slave2
</code></pre><p>版本规划<br><a href="https://hbase.apache.org/book.html" target="_blank" rel="noopener">https://hbase.apache.org/book.html</a><br>hbase官方支持的，hadoop2.8.5  hbase2.1.1 zookeeper最高版本即可</p>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><ol>
<li><p>关闭防火墙和selinux</p>
<pre><code>systemctl stop firewalld.service #停止firewall
systemctl disable firewalld.service #禁止firewall开机启动
</code></pre></li>
<li>关闭selinux</li>
</ol>
<pre><code>setenforce 0  #临时关闭

#永久关闭
vi /etc/selinux/config
然后将 SELINUX=enforcing改为SELINUX=disabled
</code></pre><ol start="3">
<li><p>配置所有机器的hostname和hosts</p>
<pre><code>hostnamectl set-hostname master  #将206的机器改成这个
hostnamectl set-hostname slave1  #将207的机器改成这个
hostnamectl set-hostname slave2  #将208的机器改成这个

#查看主机名
hostname  

#3台机器都修改hosts文件
vim /etc/hosts
#在后面添加：
172.168.20.206 master
172.168.20.207 slave1
172.168.20.208 slave2  
</code></pre></li>
</ol>
<pre><code>#并且将第一行注释，即
#127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4  

#配置完成后，看看是否可以ping通,在master机器上
ping slave1    
ping slave1                                             
</code></pre><ol start="4">
<li><p>配置ssh免密钥登陆</p>
<pre><code>#在master节点上配置
#1.生成密钥
ssh-keygen -t rsa  #一路回车即可，生成的文件存放于/root/.ssh目录下
#2.将.ssh目录下的公钥发送给所有机器
ssh-copy-id id_rsa.pub root@master  给master机器配置，因为后面的hadoop需求登陆自己的机器，同样需要账号
ssh-copy-id id_rsa.pub root@slave1
ssh-copy-id id_rsa.pub root@slave2
</code></pre></li>
</ol>
<h1 id="jdk安装"><a href="#jdk安装" class="headerlink" title="jdk安装"></a>jdk安装</h1><p>3台机器都做</p>
<p>整个的大数据生态系统是有java写的，所以需要安装jdk<br>从官网下载<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p>
<p>下载linux绿色版的，直接解压，配置环境变量即可</p>
<p>解压到/usr/local/jdk目录下</p>
<p>环境变量如下：</p>
<pre><code>export JAVA_HOME=/usr/local/jdk
export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
export PATH=$PATH:$JAVA_HOME/bin

#将上述配置添加到/etc/profile 目录下，然后
source /etc/profile 即可

#或者将上述配置写入文件中，然后将写入的文件添加到/root/.bash_profile中，然后source .bash_profile即可
</code></pre><h1 id="hadoop安装"><a href="#hadoop安装" class="headerlink" title="hadoop安装"></a>hadoop安装</h1><p>master节点配置</p>
<p>官网下载hadoop，都是绿色版的。解压，然后配置环境变量</p>
<p>配置如下：</p>
<pre><code>export HADOOP_HOME=/usr/local/hadoop
export PATH=$PATH:$HADOOP_HOME/sbin
export PATH=$PATH:$HADOOP_HOME/bin

#生效方式同jdk
</code></pre><ol>
<li><p>修改hadoop-env.sh 配置文件,存在于/usr/local/hadoop/etc/hadoop目录中</p>
<pre><code>vim hadoop-env.sh
#修改HAVA_HOME为  
export JAVA_HOME=/usr/local/jdk
</code></pre></li>
<li><p>修改core-site.xml，在<configuration>加入</configuration></p>
<pre><code>&lt;property&gt; 
    &lt;name&gt;fs.defaultFS&lt;/name&gt; 
    &lt;value&gt;hdfs://master:9000&lt;/value&gt;   
&lt;/property&gt; 
&lt;property&gt; 
    &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; 
    &lt;value&gt;/usr/local/hadoop/tempdata&lt;/value&gt; 
&lt;/property&gt; 
</code></pre></li>
<li><p>修改hdfs-site.xml，在<configuration>加入</configuration></p>
<pre><code>&lt;property&gt;
    &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;
    &lt;value&gt;/usr/local/hadoop/data/hadoopdata/name&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;
    &lt;value&gt;/usr/local/hadoop/data/hadoopdata/data&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.replication&lt;/name&gt;
    &lt;value&gt;2&lt;/value&gt; #块备份的数量
&lt;/property&gt;
</code></pre></li>
</ol>
<ol start="4">
<li><p>修改mapred-site.xml cp mapred-site.xml.template mapred-site.xml，加入</p>
<pre><code>&lt;property&gt;
    &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
    &lt;value&gt;yarn&lt;/value&gt; 
&lt;/property&gt;
</code></pre></li>
<li><p>修改 yarn-env.sh，添加</p>
<pre><code>export JAVA_HOME=/usr/local/jdk
</code></pre></li>
<li><p>修改yarn-site.xml</p>
<pre><code>&lt;property&gt; &lt;!--NodeManager上运行的附属服务，用于运行mapreduce--&gt; 
　　&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; 
　　&lt;value&gt;mapreduce_shuffle&lt;/value&gt; 
&lt;/property&gt; 
&lt;property&gt; 
　　&lt;name&gt;yarn.nodemanager.aux-services.mapreduce.shuffle.class&lt;/name&gt; 
　　&lt;value&gt;org.apache.hadoop.mapred.ShuffleHandler&lt;/value&gt; 
&lt;/property&gt; 
</code></pre></li>
<li><p>修改 slaves，这个是管理集群的，去掉localhost，直接加入slave1、slave2，有多少台data节点，此处就写多少台data节点的机器名称</p>
<pre><code>slave1
slave2
</code></pre></li>
</ol>
<ol start="8">
<li><p>在上述配置结束后，将master上的/usr/local/hadoop目录复制到 slave1和slave2上面</p>
<pre><code>scp -r /usr/local/hadoop root@slave1:/usr/local/
scp -r /usr/local/hadoop root@slave2:/usr/local/
</code></pre></li>
<li><p>在master节点上初始化name节点</p>
<pre><code>hdfs name -format
</code></pre></li>
<li><p>在master集群上启动hadoop集群</p>
<pre><code>start-all.sh
</code></pre></li>
<li><p>所有机器jps查看集群状态</p>
<p>如果master节点上有namenode节点，slave节点上有datanode即可<br>同时，也可以查看<a href="http://172.168.20.206:50070，hadoop管理平台，看看有没有data节点，如果Live" target="_blank" rel="noopener">http://172.168.20.206:50070，hadoop管理平台，看看有没有data节点，如果Live</a> Nodes值为2表示成功</p>
</li>
</ol>
<h1 id="zookeeper安装"><a href="#zookeeper安装" class="headerlink" title="zookeeper安装"></a>zookeeper安装</h1><p>官方下载zookeeper找最新版本即可，绿色版本的，解压后，直接配置环境变量，内容如下</p>
<pre><code>export ZOOKEEPER_HOME=/usr/local/zookeeper
export PATH=$PATH:$ZOOKEEPER_HOME/bin
#配置方式同jdk
</code></pre><ol>
<li><p>配置文件修改，在zookeeper的安装目录下的conf的目录内<br>cp zoo_sample.cfg zoo.cfg</p>
<pre><code>vim zoo.cfg 
dataDir=/usr/local/zookeeper/data/data  #修改此目录
dataLogDir=/usr/local/zookeeper/data/logs #追加此目录
server.1=master:2888:3888  #追加
server.2=slave1:2888:3888  #追加
server.3=slave2:2888:3888  #追加
</code></pre></li>
<li><p>将此文件拷贝到slave1和slave2</p>
<pre><code>scp -r /usr/local/zookeeper root@slave1:/usr/local/
scp -r /usr/local/zookeeper root@slave2:/usr/local/
</code></pre></li>
<li><p>创建myid文件</p>
<p> 在每台机器上对于的dataDir目录下，创建myid文件</p>
<pre><code>vim myid
1 #内容为zoo.cfg中server.1的1，比如，master对于的是server.1，主机生的myid文件中中的内容就为1
</code></pre></li>
<li><p>3台机器都启动zookeeper</p>
<pre><code>zkServer.sh start #此时zookeeper会自己选举主节点和从节点
</code></pre></li>
<li><p>3台机器查看是否成功启动</p>
<pre><code>zkServer.sh status
</code></pre><p> 出现的内容中包含Mode: follower，表示是从节点,Mode: leader表示是主节点</p>
</li>
</ol>
<h1 id="hbase"><a href="#hbase" class="headerlink" title="hbase"></a>hbase</h1><p>官方下载，绿色版的解压，配置环境变量，解压到/usr/local/hbase目录下</p>
<pre><code>export HBASE_HOME=/usr/local/hbase
export PATH=$PATH:$HBASE_HOME/bin
</code></pre><ol>
<li><p>修改配置文件/usr/local/hbase/conf 下的hbase-env.sh</p>
<pre><code>vim hbase-env.sh
#在最后面直接追加
export JAVA_HOME=/usr/local/jdk
export HBASE_CLASSPATH=/usr/local/hadoop/etc/hadoop
export HBASE_MANAGES_ZK=false
</code></pre></li>
<li><p>修改hbase-site.xml</p>
<pre><code>&lt;property&gt;
    &lt;name&gt;hbase.rootdir&lt;/name&gt;
    &lt;value&gt;hdfs://master:9000/hbase&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hbase.master&lt;/name&gt;
    &lt;value&gt;master&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt;
    &lt;value&gt;2181&lt;/value&gt;                                                    # 这里指的是zook的端口
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;                                    # 主机名一定要对应上
    &lt;value&gt;master,slave1,slave2&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;zookeeper.session.timeout&lt;/name&gt;                                 # zook的session超时时长
    &lt;value&gt;60000000&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.support.append&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
</code></pre></li>
<li><p>修改regionservers</p>
<pre><code>#localhost
slave1
slave2
</code></pre></li>
<li><p>复制到从服务器上</p>
<pre><code>scp -r /usr/local/hbase root@slave1:/usr/local/
scp -r /usr/local/hbase root@slave2:/usr/local/
</code></pre></li>
<li><p>启动hbase集群</p>
<pre><code>start-hbase.sh
</code></pre><p>  启动过程中可能会出现问题，实时观察日志，删除log4的jar包，将htrace-3.0的包复制到/usr/local/hbase/lib目录下等</p>
</li>
<li><p>jps 查看</p>
<p> 主节点有HMaster 从节点有HRegionServer</p>
</li>
<li><p>shell测试</p>
<pre><code>hbase shell  #进入shell，创建表测试
</code></pre></li>
</ol>
<h1 id="python-操作hbase"><a href="#python-操作hbase" class="headerlink" title="python 操作hbase"></a>python 操作hbase</h1><ol>
<li><p>安装thrift，参考官网</p>
<p> <a href="http://thrift.apache.org/docs/install/centos，也可参考" target="_blank" rel="noopener">http://thrift.apache.org/docs/install/centos，也可参考</a><br> <a href="https://blog.csdn.net/yangzhenzhen/article/details/77823331" target="_blank" rel="noopener">https://blog.csdn.net/yangzhenzhen/article/details/77823331</a><br> 步骤如下</p>
<pre><code>yum -y update
yum -y groupinstall &quot;Development Tools&quot;
yum -y install automake libtool flex bison pkgconfig gcc-c++ boost-devel libevent-devel zlib-devel python-devel ruby-devel openssl-devel

安装boost
tar zxvf boost_1_68_0.tar.gz
cd boost_1_68_0
./bootstrap.sh
./b2 install

安装thrift
cd thrift
./bootstrap.sh
./configure --with-lua=no
make
make install 

#安装过程中会出下错误
find / -name libboost_unit_test_framework.a
ln -s /usr/local/lib/libboost_unit_test_framework.a /usr/lib64/libboost_unit_test_framework.a

hbase启动thrift
hbase-daemon.sh start thrift  默认开启9090端口
</code></pre></li>
<li><p>python操作hbase</p>
<pre><code>from thrift.transport import TSocket,TTransport
from thrift.protocol import TBinaryProtocol
from hbase import Hbase
from hbase.ttypes import ColumnDescriptor
from hbase.ttypes import ColumnDescriptor, Mutation, BatchMutation, TRegionInfo
from hbase.ttypes import IOError, AlreadyExists

# thrift默认端口是9090
socket = TSocket.TSocket(&apos;172.168.20.206&apos;,9090)
# socket.setTimeout(5000)

transport = TTransport.TBufferedTransport(socket)
protocol = TBinaryProtocol.TBinaryProtocol(transport)

client = Hbase.Client(protocol)
socket.open()

print (client.getTableNames())
# print(client.get(&apos;test&apos;,&apos;row1&apos;,&apos;cf:a&apos;))
# 定义列族
# column = ColumnDescriptor(name=&apos;cf&apos;)
# column2 = ColumnDescriptor(name=&apos;info&apos;)
# # 创建表
# client.createTable(&apos;test1&apos;,[column])
#禁用表
# client.disableTable(&apos;test1&apos;)
#删除表，删除之前必须先禁用表
# client.deleteTable(&apos;test1&apos;)

#插入一行
# mutations = [Mutation(column=&quot;cf:Name&quot;, value=&quot;Jason&quot;),Mutation(column=&quot;cf:age&quot;, value=&quot;5&quot;)]
# # client.mutateRow(&quot;表名&quot;,&quot;rowkey&quot;,mutations)
# client.mutateRow(&quot;test1&quot;,&quot;2018111601&quot;,mutations)
#
# # # 插入多行
# rowMutations = [BatchMutation(&quot;2018111602&quot;, mutations), BatchMutation(&quot;2018111603&quot;, mutations)]
# client.mutateRows(&quot;test1&quot;, rowMutations)
#
# # 删除一行
# client.deleteAllRow(&quot;test1&quot;, &quot;2018111601&quot;)

#查询一条数据
# scanId = client.scannerOpen(&quot;test1&quot;,&quot;&quot;,[&quot;cf&quot;])
# scanRescult =  client.scannerGet(scanId) #从scan中取一条
#只能按照rowkey查询一条数据
# scanId = client.scannerOpen(&quot;test1&quot;,&quot;2018111603&quot;,[&quot;cf&quot;])
# scanRescult =  client.scannerGet(scanId) #按照rowkey从scan中取一条
# print(scanRescult)
#按照rowkey查询多条数据
# scanId = client.scannerOpen(&quot;test1&quot;,&quot;2018111602&quot;,[&quot;cf&quot;])
# scanRescult1 = client.scannerGetList(scanId,50) #从scan以指定rowkey开始从中取多条
# print(scanRescult1)
</code></pre></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">56</span>
                    <span class="site-state-item-name">Artikel</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  

  
</div>


  <div class="powered-by">Erstellt mit  <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  

  

  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  

  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
